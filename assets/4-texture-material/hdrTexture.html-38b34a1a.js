import"../reset-56fd7512.js";import{p as Y,H as M,q as x,r as A,s as O,j as D,S as X,c as J,t as K,E as Q,u as Z,n as ee,a as re,A as ne,o as te,b as ae,W as oe}from"../three.module-30b36ebb.js";import{O as ie}from"../OrbitControls-19869cf3.js";import{G as se}from"../lil-gui.esm-b4f18ba3.js";class le extends Y{constructor(w){super(w),this.type=M}parse(w){const d=function(e,t){switch(e){case 1:console.error("THREE.RGBELoader Read Error: "+(t||""));break;case 2:console.error("THREE.RGBELoader Write Error: "+(t||""));break;case 3:console.error("THREE.RGBELoader Bad File Format: "+(t||""));break;default:case 4:console.error("THREE.RGBELoader: Error: "+(t||""))}return-1},j=`
`,v=function(e,t,s){t=t||1024;let i=e.pos,a=-1,r=0,l="",n=String.fromCharCode.apply(null,new Uint16Array(e.subarray(i,i+128)));for(;0>(a=n.indexOf(j))&&r<t&&i<e.byteLength;)l+=n,r+=n.length,i+=128,n+=String.fromCharCode.apply(null,new Uint16Array(e.subarray(i,i+128)));return-1<a?(s!==!1&&(e.pos+=r+a+1),l+n.slice(0,a)):!1},V=function(e){const t=/^#\?(\S+)/,s=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,o=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,i=/^\s*FORMAT=(\S+)\s*$/,a=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,r={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let l,n;if(e.pos>=e.byteLength||!(l=v(e)))return d(1,"no header found");if(!(n=l.match(t)))return d(3,"bad initial token");for(r.valid|=1,r.programtype=n[1],r.string+=l+`
`;l=v(e),l!==!1;){if(r.string+=l+`
`,l.charAt(0)==="#"){r.comments+=l+`
`;continue}if((n=l.match(s))&&(r.gamma=parseFloat(n[1])),(n=l.match(o))&&(r.exposure=parseFloat(n[1])),(n=l.match(i))&&(r.valid|=2,r.format=n[1]),(n=l.match(a))&&(r.valid|=4,r.height=parseInt(n[1],10),r.width=parseInt(n[2],10)),r.valid&2&&r.valid&4)break}return r.valid&2?r.valid&4?r:d(3,"missing image size specifier"):d(3,"missing format specifier")},$=function(e,t,s){const o=t;if(o<8||o>32767||e[0]!==2||e[1]!==2||e[2]&128)return new Uint8Array(e);if(o!==(e[2]<<8|e[3]))return d(3,"wrong scanline width");const i=new Uint8Array(4*t*s);if(!i.length)return d(4,"unable to allocate buffer space");let a=0,r=0;const l=4*o,n=new Uint8Array(4),y=new Uint8Array(l);let k=s;for(;k>0&&r<e.byteLength;){if(r+4>e.byteLength)return d(1);if(n[0]=e[r++],n[1]=e[r++],n[2]=e[r++],n[3]=e[r++],n[0]!=2||n[1]!=2||(n[2]<<8|n[3])!=o)return d(3,"bad rgbe scanline format");let L=0,m;for(;L<l&&r<e.byteLength;){m=e[r++];const p=m>128;if(p&&(m-=128),m===0||L+m>l)return d(3,"bad scanline data");if(p){const g=e[r++];for(let U=0;U<m;U++)y[L++]=g}else y.set(e.subarray(r,r+m),L),L+=m,r+=m}const q=o;for(let p=0;p<q;p++){let g=0;i[a]=y[p+g],g+=o,i[a+1]=y[p+g],g+=o,i[a+2]=y[p+g],g+=o,i[a+3]=y[p+g],a+=4}k--}return i},P=function(e,t,s,o){const i=e[t+3],a=Math.pow(2,i-128)/255;s[o+0]=e[t+0]*a,s[o+1]=e[t+1]*a,s[o+2]=e[t+2]*a,s[o+3]=1},W=function(e,t,s,o){const i=e[t+3],a=Math.pow(2,i-128)/255;s[o+0]=A.toHalfFloat(Math.min(e[t+0]*a,65504)),s[o+1]=A.toHalfFloat(Math.min(e[t+1]*a,65504)),s[o+2]=A.toHalfFloat(Math.min(e[t+2]*a,65504)),s[o+3]=A.toHalfFloat(1)},G=new Uint8Array(w);G.pos=0;const f=V(G);if(f!==-1){const e=f.width,t=f.height,s=$(G.subarray(G.pos),e,t);if(s!==-1){let o,i,a;switch(this.type){case x:a=s.length/4;const r=new Float32Array(a*4);for(let n=0;n<a;n++)P(s,n*4,r,n*4);o=r,i=x;break;case M:a=s.length/4;const l=new Uint16Array(a*4);for(let n=0;n<a;n++)W(s,n*4,l,n*4);o=l,i=M;break;default:console.error("THREE.RGBELoader: unsupported type: ",this.type);break}return{width:e,height:t,data:o,header:f.string,gamma:f.gamma,exposure:f.exposure,type:i}}}return null}setDataType(w){return this.type=w,this}load(w,B,T,I){function S(_,d){switch(_.type){case x:case M:_.encoding=O,_.minFilter=D,_.magFilter=D,_.generateMipmaps=!1,_.flipY=!0;break}B&&B(_,d)}return super.load(w,S,T,I)}}const u="/threejs-tutorial/",h={width:window.innerWidth,height:window.innerHeight},ce={envMap:3},c=new X,de=new J(5);c.add(de);const he=new K,H=he.load([`${u}textures/environmentMaps/1/px.jpg`,`${u}textures/environmentMaps/1/nx.jpg`,`${u}textures/environmentMaps/1/py.jpg`,`${u}textures/environmentMaps/1/ny.jpg`,`${u}textures/environmentMaps/1/pz.jpg`,`${u}textures/environmentMaps/1/nz.jpg`]);let F;const me=new le;me.loadAsync(`${u}textures/hdr/002.hdr`).then(R=>{R.mapping=Q,F=R});const pe=new Z(1,20,20),ge=new ee({metalness:.7,roughness:.1}),_e=new re(pe,ge);c.add(_e);const Ee=new se;Ee.add(ce,"envMap",{环境贴图:1,hdr:2,无:3}).name("贴图类型").onChange(R=>{R===1?(c.background=H,c.environment=H):R===2?(c.background=F,c.environment=F):(c.background=null,c.environment=null)});const Re=new ne(16777215,.5);c.add(Re);const N=new te(16777215,.5);N.position.set(10,10,10);c.add(N);const b=new ae(75,h.width/h.height,.1,1e3);b.position.z=10;b.lookAt(c.position);c.add(b);const E=new oe;E.setSize(h.width,h.height);E.setClearColor(12178431,1);document.body.appendChild(E.domElement);const z=new ie(b,E.domElement);z.enableDamping=!0;C();window.addEventListener("resize",()=>{h.width=window.innerWidth,h.height=window.innerHeight,b.aspect=h.width/h.height,b.updateProjectionMatrix(),E.setSize(h.width,h.height),E.setPixelRatio(Math.min(window.devicePixelRatio,2))});window.addEventListener("dblclick",()=>{document.fullscreenElement?document.exitFullscreen():E.domElement.requestFullscreen()});function C(){z.update(),E.render(c,b),requestAnimationFrame(C)}
