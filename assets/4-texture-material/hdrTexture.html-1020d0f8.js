import"../reset-56fd7512.js";import{p as Y,H as G,q as B,r as M,s as $,j as D,S as O,c as X,t as J,E as K,u as Q,n as Z,a as ee,A as re,o as ne,b as te,W as ae}from"../three.module-30b36ebb.js";import{O as oe}from"../OrbitControls-19869cf3.js";import{G as ie}from"../lil-gui.esm-b4f18ba3.js";class se extends Y{constructor(w){super(w),this.type=G}parse(w){const d=function(e,t){switch(e){case 1:console.error("THREE.RGBELoader Read Error: "+(t||""));break;case 2:console.error("THREE.RGBELoader Write Error: "+(t||""));break;case 3:console.error("THREE.RGBELoader Bad File Format: "+(t||""));break;default:case 4:console.error("THREE.RGBELoader: Error: "+(t||""))}return-1},C=`
`,S=function(e,t,s){t=t||1024;let i=e.pos,a=-1,r=0,l="",n=String.fromCharCode.apply(null,new Uint16Array(e.subarray(i,i+128)));for(;0>(a=n.indexOf(C))&&r<t&&i<e.byteLength;)l+=n,r+=n.length,i+=128,n+=String.fromCharCode.apply(null,new Uint16Array(e.subarray(i,i+128)));return-1<a?(s!==!1&&(e.pos+=r+a+1),l+n.slice(0,a)):!1},V=function(e){const t=/^#\?(\S+)/,s=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,o=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,i=/^\s*FORMAT=(\S+)\s*$/,a=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,r={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let l,n;if(e.pos>=e.byteLength||!(l=S(e)))return d(1,"no header found");if(!(n=l.match(t)))return d(3,"bad initial token");for(r.valid|=1,r.programtype=n[1],r.string+=l+`
`;l=S(e),l!==!1;){if(r.string+=l+`
`,l.charAt(0)==="#"){r.comments+=l+`
`;continue}if((n=l.match(s))&&(r.gamma=parseFloat(n[1])),(n=l.match(o))&&(r.exposure=parseFloat(n[1])),(n=l.match(i))&&(r.valid|=2,r.format=n[1]),(n=l.match(a))&&(r.valid|=4,r.height=parseInt(n[1],10),r.width=parseInt(n[2],10)),r.valid&2&&r.valid&4)break}return r.valid&2?r.valid&4?r:d(3,"missing image size specifier"):d(3,"missing format specifier")},j=function(e,t,s){const o=t;if(o<8||o>32767||e[0]!==2||e[1]!==2||e[2]&128)return new Uint8Array(e);if(o!==(e[2]<<8|e[3]))return d(3,"wrong scanline width");const i=new Uint8Array(4*t*s);if(!i.length)return d(4,"unable to allocate buffer space");let a=0,r=0;const l=4*o,n=new Uint8Array(4),f=new Uint8Array(l);let v=s;for(;v>0&&r<e.byteLength;){if(r+4>e.byteLength)return d(1);if(n[0]=e[r++],n[1]=e[r++],n[2]=e[r++],n[3]=e[r++],n[0]!=2||n[1]!=2||(n[2]<<8|n[3])!=o)return d(3,"bad rgbe scanline format");let y=0,m;for(;y<l&&r<e.byteLength;){m=e[r++];const p=m>128;if(p&&(m-=128),m===0||y+m>l)return d(3,"bad scanline data");if(p){const g=e[r++];for(let k=0;k<m;k++)f[y++]=g}else f.set(e.subarray(r,r+m),y),y+=m,r+=m}const q=o;for(let p=0;p<q;p++){let g=0;i[a]=f[p+g],g+=o,i[a+1]=f[p+g],g+=o,i[a+2]=f[p+g],g+=o,i[a+3]=f[p+g],a+=4}v--}return i},P=function(e,t,s,o){const i=e[t+3],a=Math.pow(2,i-128)/255;s[o+0]=e[t+0]*a,s[o+1]=e[t+1]*a,s[o+2]=e[t+2]*a,s[o+3]=1},W=function(e,t,s,o){const i=e[t+3],a=Math.pow(2,i-128)/255;s[o+0]=M.toHalfFloat(Math.min(e[t+0]*a,65504)),s[o+1]=M.toHalfFloat(Math.min(e[t+1]*a,65504)),s[o+2]=M.toHalfFloat(Math.min(e[t+2]*a,65504)),s[o+3]=M.toHalfFloat(1)},L=new Uint8Array(w);L.pos=0;const b=V(L);if(b!==-1){const e=b.width,t=b.height,s=j(L.subarray(L.pos),e,t);if(s!==-1){let o,i,a;switch(this.type){case B:a=s.length/4;const r=new Float32Array(a*4);for(let n=0;n<a;n++)P(s,n*4,r,n*4);o=r,i=B;break;case G:a=s.length/4;const l=new Uint16Array(a*4);for(let n=0;n<a;n++)W(s,n*4,l,n*4);o=l,i=G;break;default:console.error("THREE.RGBELoader: unsupported type: ",this.type);break}return{width:e,height:t,data:o,header:b.string,gamma:b.gamma,exposure:b.exposure,type:i}}}return null}setDataType(w){return this.type=w,this}load(w,A,F,T){function I(_,d){switch(_.type){case B:case G:_.encoding=$,_.minFilter=D,_.magFilter=D,_.generateMipmaps=!1,_.flipY=!0;break}A&&A(_,d)}return super.load(w,I,F,T)}}const h={width:window.innerWidth,height:window.innerHeight},le={envMap:3},c=new O,ce=new X(5);c.add(ce);const de=new J,U=de.load(["/textures/environmentMaps/1/px.jpg","/textures/environmentMaps/1/nx.jpg","/textures/environmentMaps/1/py.jpg","/textures/environmentMaps/1/ny.jpg","/textures/environmentMaps/1/pz.jpg","/textures/environmentMaps/1/nz.jpg"]);let x;const he=new se;he.loadAsync("/textures/hdr/002.hdr").then(R=>{R.mapping=K,x=R});const me=new Q(1,20,20),pe=new Z({metalness:.7,roughness:.1}),ge=new ee(me,pe);c.add(ge);const _e=new ie;_e.add(le,"envMap",{环境贴图:1,hdr:2,无:3}).name("贴图类型").onChange(R=>{R===1?(c.background=U,c.environment=U):R===2?(c.background=x,c.environment=x):(c.background=null,c.environment=null)});const Ee=new re(16777215,.5);c.add(Ee);const H=new ne(16777215,.5);H.position.set(10,10,10);c.add(H);const u=new te(75,h.width/h.height,.1,1e3);u.position.z=10;u.lookAt(c.position);c.add(u);const E=new ae;E.setSize(h.width,h.height);E.setClearColor(12178431,1);document.body.appendChild(E.domElement);const N=new oe(u,E.domElement);N.enableDamping=!0;z();window.addEventListener("resize",()=>{h.width=window.innerWidth,h.height=window.innerHeight,u.aspect=h.width/h.height,u.updateProjectionMatrix(),E.setSize(h.width,h.height),E.setPixelRatio(Math.min(window.devicePixelRatio,2))});window.addEventListener("dblclick",()=>{document.fullscreenElement?document.exitFullscreen():E.domElement.requestFullscreen()});function z(){N.update(),E.render(c,u),requestAnimationFrame(z)}
